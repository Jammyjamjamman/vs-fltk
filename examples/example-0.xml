<?xml version="1.0" encoding="UTF-8"?>
<app type="native">
    <import src="file://./two-buttons.xml" as="TwoButtons" />
    <import src="file://./three-buttons.xml" as="ThreeButtons">
        <label>It does not exist</label>
    </import>


    <script-global lang="c">
        <def>

        </def>
        <decl>

        </decl>
    </script-global>
    <script lang="c">
        <![CDATA[ 
        int dispatcher(void* base, const char* key, const char* value){
            $log(0,"HELLO WORLD");
            return 1;
        }
        ]]>
    </script>
    <window box.w="640" box.h="480" frame.mode="node">
        <button label="callback-top">
            <script lang="c">
            <![CDATA[ 
            void callback(){
                $log(0,"Tying call %p",$("..."));
                $$prop($("..."),"ciao","mondo");
                return;
            }
            ]]>
            </script>
        </button>
    </window>
    <window box.w="640" box.h="480" name="ss">
        <use>
            <on-load.fail>
                <button box="0,0,50,50" label="Oh no!"></button>
            </on-load.fail>
        </use>

        <use src="./two-buttons.xml">
            <on-load.fail>
                <button box="200,250,50,50" label="Oh no!"></button>
            </on-load.fail>
            <inject>
                <button box="200,200,50,50" label="Oh yes!"></button>
            </inject>
        </use>

        <TwoButtons />
        <namespace name="%hooo">
            <mixin name="+button" bg.colour="#00ae92" />
            <viewport box="300,300,200,200" bg.colour="#99df34">
                <button label="Ciao!"></button>
            </viewport>
            <button name="%tmp-data" box.y="200"></button>
            <button name="%js-button" box.y="300" label="JS BUTTON">
                <script lang="js">
                    function marika(){console.log("Banana magika");}
                    function callback(){$.log(0,"Banana magika %d %s", 145, "ottenwotten");}
                    $cb(marika);
                </script>
            </button>
            <button base="parent" box="0,0,80,30" on.callback="on_click_a" name="%quick"
                label="CBTN1">
                <mixin box="200,200,100,100" box.y="100" box.w="200" />
                <script lang="c">
                <![CDATA[ 
                //#include <vs.h>
                
                int count=0;

                int test(void* _args){
                    struct args_t{int a; int b;} *args = _args;
                    $log(LOG_LOG,"DRIP, DROP %d",args->a,+args->b);
                    return 0;
                }
                $cb(test);

                void on_click_a(){
                    static char strbuff[32];
                    struct args_t{int a; int b;} args = {10,20};
                    __vs_call(&vs_self,"test",&args);
                    $call("test",&args);
                    test(&args);
                    self_t tmp = vs_resolve_name("%tmp-data");
                    if(tmp!=0){
                        itoa(count,strbuff,10);
                        vs_apply_prop(tmp,"label",strbuff);
                    }
                    $prop("label","QUINQUE");
                    if(count==0)
                        $log(LOG_LOG,"DON\'T YOU DARE TO APPROACH MIQUELLA THE KIND!");
                    else if(count==1)
                        $log(LOG_LOG,"BAYLE! VILE BAYLE! YOU WILL RUE THIS DAY!");
                    else if(count==2)
                        $log(LOG_LOG,"BEHOLD! A TRUE DRAKE WARRIOR. AND I, IGON. YOUR FEARS MADE FLESH");
                    else if(count==3)
                        $log(LOG_LOG,"NO MATTER HOW TENDER, HOW EXQUISITE, A LIE WILL REMAIN A LIE.");
                    else 
                        $log(LOG_LOG,"But nobody came.");
                    count++;
                }
                $cb(on_click_a);

                unsigned long int on_compiled(){
                    //vs_log(LOG_INFO,"Worldo Hellooooooo!");
                    return 5;
                }
                ]]>
            </script>
            </button>
        </namespace>
        <button base="parent" box="0,40,80,30" on.callback="on_click_a" label="BTN2">
            <script lang="c">
            <![CDATA[ 
            void callback(){
                //app_debug("Hello world 2");
            }
            ]]>
            </script>
        </button>

        <namespace type="native" name="%roots">
            <mixin name="+button" bg.colour="#00ae92" />
            <mixin name="*" label.colour="#34a977" />
            <mixin name="btn-2" box="150,40,80,30" label="Makika" />

            <script lang="c">
            <![CDATA[

            void on_click_a1(){
                $log(LOG_PANIC,"Hello world 1!");
            }
            $export(on_click_a1);
            ]]>
            <![CDATA[

            void on_click_b1(){
                $log(LOG_PANIC,"Hello world 2!");
            }
            $export(on_click_b1);
            ]]>
        </script>

            <group label="Hello world!" box="0,0,300,800" class="">
                <!-- We can define a global script for this -->
                <mixin name="btn-1" mixin="btn-2" box="150,40,80,80" />


                <button.toggle mixin="btn-1" base="parent" on.callback="on_click_b1"
                    bg.colour="#ff0000"
                    label.colour="#00ff00" bg.colour.selected="#00ffff" test="WW">
                    <script lang="c++">
                    <![CDATA[ 
                    void on_click_c(){
                        //app_debug("Hello world 2");
                    }
                    ]]>
                </script>
                </button.toggle>
                <button kuku="dd" base="parent" name="ss" box="140,200,80,30"
                    on.callback="on_click_a1"
                    label="BTN3" tooltip="Bananae magicae!" label.align.pos="bottom-right">
                    <script lang="c">
                    <![CDATA[ 
                    void on_click_c(){
                        //app_debug("Hello world 2");
                    }
                    ]]>
                </script>
                </button>
                <button base="parent" mixin="statusB" box="150,80,80,30" on.callback="callback"
                    label="BTN5">
                    <mixin name="statusA" label.colour="#123399" bg.colour="#9972a3" />
                    <mixin name="statusB" label.colour="#229999" bg.colour="#99a372" />
                    <script lang="c">
                    <![CDATA[
                    int i = 0;
                    void callback(){
                        if(i%2==0)$mixin("statusA");
                        else $mixin("statusB");
                        $log(0,"Hi there!");
                        i++;
                    }
                    ]]>
                </script>
                </button>
            </group>
        </namespace>
        <namespace type="wasm">

        </namespace>
        <namespace type="quickjs">

        </namespace>
        <namespace type="ext">

        </namespace>
    </window>
</app>